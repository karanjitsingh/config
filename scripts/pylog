#!/bin/bash

# Usage: pylog <python_file.py>

if [ $# -ne 1 ]; then
    echo "Usage: pylog <python_file.py>"
    exit 1
fi

# Create logs directory if it doesn't exist
mkdir -p ./logs

# Find the largest n from existing run_n files
max_n=0
for file in ./logs/run_*; do
    if [[ -f "$file" && "$file" =~ ./logs/run_([0-9]+)$ ]]; then
        n=${BASH_REMATCH[1]}
        if (( n > max_n )); then
            max_n=$n
        fi
    fi
done

# Calculate the next n
new_n=$((max_n + 1))

# Set the log file path
log_file="./logs/run_${new_n}"

echo -e "Logging to $log_file\n"

# Run the Python script with unbuffered output and tee to the log file
python -u "$1" | tee "$log_file"

echo ""
echo "$log_file"
